{"title":"在中国国内使用Google reCAPTCHA 2/3 验证码的方法","date":"2020-02-13T10:36:51.000Z","date_formatted":{"ll":"2020年2月13日","L":"2020/02/13","MM-DD":"02-13"},"thumbnail":"https://cdn.jsdelivr.net/gh/gaowanliang/p/img/m_i3384843040.jpg","link":"2020/02/13/use-recaptcha-in-china","comments":true,"tags":["教程"],"categories":["reCAPTCHA","教程","验证码"],"updated":"2020-02-15T14:19:34.406Z","content":"<p>我看版本2的有人说了，我简单的说一下版本3的使用和集成</p>\n<p>国内使用reCAPTCHA只需要将 <a href=\"http://www.google.com\" target=\"_blank\">www.google.com</a> 替换成 <a href=\"http://www.recaptcha.net，即可在国内使用\" target=\"_blank\">www.recaptcha.net，即可在国内使用</a> recaptcha 的服务。\n如 <a href=\"https://www.google.com/recaptcha/api.js\" target=\"_blank\">https://www.google.com/recaptcha/api.js</a> 替换成 <a href=\"https://www.recaptcha.net/recaptcha/api.js，https://www.google.com/recaptcha/api/siteverify\" target=\"_blank\">https://www.recaptcha.net/recaptcha/api.js，https://www.google.com/recaptcha/api/siteverify</a> 替换成 <a href=\"https://www.recaptcha.net/recaptcha/api/siteverify。\" target=\"_blank\">https://www.recaptcha.net/recaptcha/api/siteverify。</a></p>\n<p>浏览器界面请使用以下方法使用</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script src=<span class=\"string\">\"https://www.recaptcha.net/recaptcha/api.js?render=客户端代码\"</span>&gt;&lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    /</span><span class=\"regexp\">/验证reCAPTCHA是否载入</span></span><br><span class=\"line\"><span class=\"regexp\">    grecaptcha.ready(function () &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">        console.log(\"reCAPTCHA载入成功\")</span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;);</span></span><br><span class=\"line\"><span class=\"regexp\">    /</span><span class=\"regexp\">/生成特征验证码</span></span><br><span class=\"line\"><span class=\"regexp\">    grecaptcha.execute('客户端代码', &#123;action: 'homepage'&#125;).then(function(token) &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">       </span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;);</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>这里给一个比较完整的例子，以JavaScript和python(flask)为例</p>\n<h2 id=\"客户端代码-javascript\">客户端代码 JavaScript<a href=\"#客户端代码-javascript\" title=\"客户端代码 JavaScript\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script src=<span class=\"string\">\"https://www.recaptcha.net/recaptcha/api.js?render=客户端代码\"</span>&gt;&lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;script src=\"/</span><span class=\"regexp\">/cdn.jsdelivr.net/</span>combine/gh/jquery/jquery/dist/jquery.min.js<span class=\"string\">\"&gt;&lt;/script&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;script&gt;</span></span><br><span class=\"line\"><span class=\"string\">    grecaptcha.ready(function () &#123;</span></span><br><span class=\"line\"><span class=\"string\">        console.log(\"</span>reCAPTCHA载入成功<span class=\"string\">\")</span></span><br><span class=\"line\"><span class=\"string\">    &#125;);</span></span><br><span class=\"line\"><span class=\"string\">    $('#submit').click(function () &#123;</span></span><br><span class=\"line\"><span class=\"string\">        var d = &#123;&#125;;</span></span><br><span class=\"line\"><span class=\"string\">        var t = $('form').serializeArray();</span></span><br><span class=\"line\"><span class=\"string\">        $.each(t, function () &#123;</span></span><br><span class=\"line\"><span class=\"string\">            d[this.name] = this.value;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;);</span></span><br><span class=\"line\"><span class=\"string\">        console.log(d)</span></span><br><span class=\"line\"><span class=\"string\">        grecaptcha.execute('客户端代码', &#123; action: 'homepage' &#125;).then(function (token) &#123;</span></span><br><span class=\"line\"><span class=\"string\">            d[\"</span>recaptcha<span class=\"string\">\"] = token</span></span><br><span class=\"line\"><span class=\"string\">            $.ajax(&#123;</span></span><br><span class=\"line\"><span class=\"string\">                type: 'post',</span></span><br><span class=\"line\"><span class=\"string\">                data: d,</span></span><br><span class=\"line\"><span class=\"string\">                url: 'verify',</span></span><br><span class=\"line\"><span class=\"string\">                cache: false,</span></span><br><span class=\"line\"><span class=\"string\">                dataType: 'text',</span></span><br><span class=\"line\"><span class=\"string\">                success: function (data) &#123;</span></span><br><span class=\"line\"><span class=\"string\">                    if (data == \"</span><span class=\"number\">1</span><span class=\"string\">\") &#123;</span></span><br><span class=\"line\">                        $(\"#ok\").text(\"通过验证，您不是机器人\")</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        $(<span class=\"string\">\"#ok\"</span>).text(<span class=\"string\">\"未通过验证，请重新测试\"</span>)</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"built_in\">console</span>.log(data)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"服务器端代码-pythonflask\">服务器端代码 Python(Flask)<a href=\"#服务器端代码-pythonflask\" title=\"服务器端代码 Python(Flask)\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route('/verify', methods=['POST'])</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">verify</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">'POST'</span>:</span><br><span class=\"line\">        verification = request.form[<span class=\"string\">'recaptcha'</span>]</span><br><span class=\"line\">        datas = &#123;</span><br><span class=\"line\">            <span class=\"string\">'secret'</span>: <span class=\"string\">\"服务器端代码\"</span>,</span><br><span class=\"line\">            <span class=\"string\">'response'</span>: verification</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        k = requests.post(</span><br><span class=\"line\">            <span class=\"string\">\"https://recaptcha.net/recaptcha/api/siteverify\"</span>, data=datas)</span><br><span class=\"line\">        print(k.text)</span><br><span class=\"line\">        kk = eval(k.text.replace(<span class=\"string\">'\"'</span>, <span class=\"string\">\"'\"</span>).replace(</span><br><span class=\"line\">            <span class=\"string\">'true'</span>, <span class=\"string\">\"1\"</span>).replace(<span class=\"string\">'false'</span>, <span class=\"string\">\"2\"</span>))</span><br><span class=\"line\">        <span class=\"keyword\">if</span> kk[<span class=\"string\">\"success\"</span>] == <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">\"1\"</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">\"0\"</span></span><br></pre></td></tr></table></figure>\n\n<p>同时可使用下面的命令对右下角的标志进行隐藏</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.grecaptcha-badge</span> &#123;</span></span><br><span class=\"line\">\t\tvisibility: hidden !important;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 但是谷歌强烈建议在网站上保留下面的标识 --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">small</span>&gt;</span>This site is protected by reCAPTCHA and the Google  <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://policies.google.com/privacy\"</span>&gt;</span>Privacy Policy<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> and <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://policies.google.com/terms\"</span>&gt;</span>Terms of Service<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> apply.</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">small</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 自行翻译的中文版 --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">small</span>&gt;</span>本网站受RECAPTCHA和谷歌<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://policies.google.com/privacy\"</span>&gt;</span>隐私政策<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>及<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://policies.google.com/terms\"</span>&gt;</span>服务条款<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>的保护。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">small</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"完整例子下载地址\">完整例子下载地址<a href=\"#完整例子下载地址\" title=\"完整例子下载地址\"></a></h2><p><a href=\"https://www.lanzous.com/i9doidc\" target=\"_blank\">https://www.lanzous.com/i9doidc</a></p>\n","next":{"title":"查看你在B站注册的时间","link":"2020/02/12/view-regtime-of-bilibili"},"plink":"https://gwliang.com/2020/02/13/use-recaptcha-in-china/","toc":[{"id":"客户端代码-javascript","title":"客户端代码 JavaScript","index":"1"},{"id":"服务器端代码-pythonflask","title":"服务器端代码 Python(Flask)","index":"2"},{"id":"完整例子下载地址","title":"完整例子下载地址","index":"3"}],"reward":true,"copyright":{"license":"自由转载-非商用-禁止演绎-保持署名(<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","author":"Gaowan Liang","link":"<a href=\"https://gwliang.com/2020/02/13/use-recaptcha-in-china/\" title=\"在中国国内使用Google reCAPTCHA 2/3 验证码的方法\">https://gwliang.com/2020/02/13/use-recaptcha-in-china/</a>"}}