{"title":"Linux命令行下载OneDrive分享链接中的文件","date":"2020-05-26T14:24:24.000Z","date_formatted":{"ll":"2020年5月26日","L":"2020/05/26","MM-DD":"05-26"},"thumbnail":"https://cdn.jsdelivr.net/gh/gaowanliang/p/img/20200518.png","link":"2020/05/26/linux-control-download-onedrive-files","comments":true,"tags":["教程"],"categories":["OneDrive"],"updated":"2020-05-26T15:04:21.474Z","content":"<p>我所知的某个游戏分享站喜欢用OneDrive来分享游戏，用OneDrive很好，抵制百度网盘我强烈支持，但是OneDrive国内有时候抽风比较厉害，而在国外OneDrive下载几乎能跑满带宽，我G口的服务器可以跑到110M/s，所以用国外服务器下载，然后再下载自己服务器里的东西会比较好。</p>\n<p>但是因为OneDrive有些坑，无法从分享界面获取真实下载链接，比如下面这个链接</p>\n<blockquote>\n<p><a href=\"https://gitaccuacnz2-my.sharepoint.com/:f:/g/personal/mail_finderacg_com/EheQwACFhe9JuGUn4hlg9esBsKyk5jp9-Iz69kqzLLF5Xw?e=FG7SHh\" target=\"_blank\">https://gitaccuacnz2-my.sharepoint.com/:f:/g/personal/mail_finderacg_com/EheQwACFhe9JuGUn4hlg9esBsKyk5jp9-Iz69kqzLLF5Xw?e=FG7SHh</a></p>\n</blockquote>\n<p>点开之后，找个文件点击下载，会得到这样的下载链接：</p>\n<blockquote>\n<p><a href=\"https://gitaccuacnz2-my.sharepoint.com/personal/mail_finderacg_com/_layouts/15/download.aspx?UniqueId=cb44677f%2Dc4af%2D44ad%2D88d4%2Dceb07d9625da\" target=\"_blank\">https://gitaccuacnz2-my.sharepoint.com/personal/mail_finderacg_com/_layouts/15/download.aspx?UniqueId=cb44677f%2Dc4af%2D44ad%2D88d4%2Dceb07d9625da</a></p>\n</blockquote>\n<p>但是如果直接在服务器里 wget 这个下载链接，100%会403: Forbidden</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/gaowanliang/p/img/20200526224303.png\" class=\"cy\"></p>\n<p>有经验的老手都知道肯定是没带 Cookie ，但是要怎么带Cookie呢，其实很简单</p>\n<p>请使用Chrome或者是Firefox，实测Firefox最快捷，不用进行更改，我下面就用Firefox进行演示。</p>\n<p>首先你需要按下F12，打开开发人员工具，然后转到网络选项，之后点击想要下载的文件进行下载，同时观察开发人员工具窗口，找到带有download.aspx/?.... 的那个链接</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/gaowanliang/p/img/20200526224906.png\" class=\"cy\"></p>\n<p>之后在那个链接上右键，选择 复制-复制为cURL命令(POSIX)</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/gaowanliang/p/img/20200526225150.png\" class=\"cy\"></p>\n<p>会在剪切板出现类似下面的命令语句</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl &#39;https:&#x2F;&#x2F;gitaccuacnz2-my.sharepoint.com&#x2F;personal&#x2F;mail_finderacg_com&#x2F;_layouts&#x2F;15&#x2F;download.aspx?UniqueId&#x3D;cb44677f%2Dc4af%2D44ad%2D88d4%2Dceb07d9625da&#39; -H &#39;User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:78.0) Gecko&#x2F;20100101 Firefox&#x2F;78.0&#39; -H &#39;Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8&#39; -H &#39;Accept-Language: zh-HK,zh-TW;q&#x3D;0.5&#39; --compressed -H &#39;Connection: keep-alive&#39; -H &#39;Referer: https:&#x2F;&#x2F;gitaccuacnz2-my.sharepoint.com&#x2F;personal&#x2F;mail_finderacg_com&#x2F;_layouts&#x2F;15&#x2F;onedrive.aspx?.......&#39; -H &#39;Cookie: CCSInfo&#x3D;NS8yOS8yMDIwIDEwOjE1OjE0IEFNC&#x2F;.....; FeatureOverrides_enableFeatures&#x3D;; FeatureOverrides_disableFeatures&#x3D;&#39; -H &#39;Upgrade-Insecure-Requests: 1&#39; -H &#39;Sec-Fetch-Dest: iframe&#39; -H &#39;Sec-Fetch-Mode: navigate&#39; -H &#39;Sec-Fetch-Site: same-origin&#39;</span><br></pre></td></tr></table></figure>\n<p>之后粘贴到Linux的命令行里，最后在后面补加一句 <code>--output file.extension</code> ,其中 <code>file.extension</code> 是想要保存的文件名。最终执行的命令就是类似这样的：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl &#39;https:&#x2F;&#x2F;gitaccuacnz2-my.sharepoint.com&#x2F;personal&#x2F;mail_finderacg_com&#x2F;_layouts&#x2F;15&#x2F;download.aspx?UniqueId&#x3D;cb44677f%2Dc4af%2D44ad%2D88d4%2Dceb07d9625da&#39; -H &#39;User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:78.0) Gecko&#x2F;20100101 Firefox&#x2F;78.0&#39; -H &#39;Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8&#39; -H &#39;Accept-Language: zh-HK,zh-TW;q&#x3D;0.5&#39; --compressed -H &#39;Connection: keep-alive&#39; -H &#39;Referer: https:&#x2F;&#x2F;gitaccuacnz2-my.sharepoint.com&#x2F;personal&#x2F;mail_finderacg_com&#x2F;_layouts&#x2F;15&#x2F;onedrive.aspx?.......&#39; -H &#39;Cookie: CCSInfo&#x3D;NS8yOS8yMDIwIDEwOjE1OjE0IEFNC&#x2F;.....; FeatureOverrides_enableFeatures&#x3D;; FeatureOverrides_disableFeatures&#x3D;&#39; -H &#39;Upgrade-Insecure-Requests: 1&#39; -H &#39;Sec-Fetch-Dest: iframe&#39; -H &#39;Sec-Fetch-Mode: navigate&#39; -H &#39;Sec-Fetch-Site: same-origin&#39; --output file.extension</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.jsdelivr.net/gh/gaowanliang/p/img/20200526225910.png\" class=\"cy\"></p>\n<p>最后就能享受高速下载了</p>\n<p>同时这个方法也适合文件夹下载，只不过前缀是 <code>xxxxx-mediap.svc.ms</code> ，其中<code>xxxxx</code>是地区代号，不同的下载链接所指向的地区不同，具体看情况，这里就不再赘述。</p>\n<p>如果使用Chrome下载，需要选择 复制cURL(Bash) 然后把里面的换行和\\ 都处理掉，要不然会不行，但是我没成功过，按理讲应该是能成功的，算了，Firefox能用就行了，又不是天天下载。</p>\n","prev":{"title":"在Debian/Ubuntu上使用rclone挂载Google Drive网盘","link":"2020/07/24/mount-gd-for-rclone"},"next":{"title":"Debian系统安装Swap虚拟内存设置","link":"2020/05/16/set-swap"},"plink":"https://gwliang.com/2020/05/26/linux-control-download-onedrive-files/","reward":true,"copyright":{"license":"自由转载-非商用-禁止演绎-保持署名(<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","author":"Gaowan Liang","link":"<a href=\"https://gwliang.com/2020/05/26/linux-control-download-onedrive-files/\" title=\"Linux命令行下载OneDrive分享链接中的文件\">https://gwliang.com/2020/05/26/linux-control-download-onedrive-files/</a>"}}