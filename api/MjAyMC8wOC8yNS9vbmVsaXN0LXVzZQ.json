{"title":"OneDrive目录列表OneList使用方法","date":"2020-08-25T13:41:36.000Z","date_formatted":{"ll":"2020年8月25日","L":"2020/08/25","MM-DD":"08-25"},"thumbnail":"https://cdn.jsdelivr.net/gh/gaowanliang/p/img/45504728_p0.png","link":"2020/08/25/onelist-use","comments":true,"tags":["教程"],"categories":["OneDrive"],"updated":"2020-08-29T11:35:43.400Z","content":"<h1 id=\"onelist\">OneList<a href=\"#onelist\" title=\"OneList\"></a></h1><ul><li>支持 国际版, 个人免费版(家庭版), 中国版(世纪互联).</li>\n<li>支持同时列出多个盘的目录.(同时挂载多个网盘或单个网盘挂载成多个<code>SubPath</code>,要求每个<code>SubPath</code>唯一)</li>\n<li>支持文件夹内超过 200 个项目</li>\n<li>支持后台自动刷新缓存.</li>\n<li>支持路径中含有特殊字符.</li>\n<li>支持使用不同目录使用不同账户密码加密(HTTP 401).</li>\n<li>支持隐藏目录和文件(跳过缓存).</li>\n<li>支持自定义 ClientID 和 SecretKey .</li>\n<li>数据储存在内存中,响应更加迅速.</li>\n</ul><h2 id=\"授权\">授权<a href=\"#授权\" title=\"授权\"></a></h2><h3 id=\"通过下面url登录-右键新标签打开\">通过下面URL登录 (右键新标签打开)<a href=\"#通过下面url登录-右键新标签打开\" title=\"通过下面URL登录 (右键新标签打开)\"></a></h3><h4 id=\"国际版-个人版家庭版\">国际版, 个人版(家庭版)<a href=\"#国际版-个人版家庭版\" title=\"国际版, 个人版(家庭版)\"></a></h4><p><a href=\"https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=78d4dc35-7e46-42c6-9023-2d39314433a5&response_type=code&redirect_uri=http://localhost/onedrive-login&response_mode=query&scope=offline_access%20User.Read%20Files.ReadWrite.All\" target=\"_blank\">https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=78d4dc35-7e46-42c6-9023-2d39314433a5&amp;response_type=code&amp;redirect_uri=http://localhost/onedrive-login&amp;response_mode=query&amp;scope=offline_access%20User.Read%20Files.ReadWrite.All</a></p>\n<h4 id=\"中国版世纪互联\">中国版(世纪互联)<a href=\"#中国版世纪互联\" title=\"中国版(世纪互联)\"></a></h4><p><a href=\"https://login.chinacloudapi.cn/common/oauth2/v2.0/authorize?client_id=dfe36e60-6133-48cf-869f-4d15b8354769&response_type=code&redirect_uri=http://localhost/onedrive-login&response_mode=query&scope=offline_access%20User.Read%20Files.ReadWrite.All\" target=\"_blank\">https://login.chinacloudapi.cn/common/oauth2/v2.0/authorize?client_id=dfe36e60-6133-48cf-869f-4d15b8354769&amp;response_type=code&amp;redirect_uri=http://localhost/onedrive-login&amp;response_mode=query&amp;scope=offline_access%20User.Read%20Files.ReadWrite.All</a></p>\n<h2 id=\"安装onelist\">安装OneList<a href=\"#安装onelist\" title=\"安装OneList\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#新建并进入OneList目录</span></span><br><span class=\"line\">mkdir /opt/OneList &amp;&amp; <span class=\"built_in\">cd</span> <span class=\"variable\">$_</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#64位系统下载</span></span><br><span class=\"line\">wget https://raw.githubusercontent.com/MoeClub/OneList/master/Rewrite/amd64/linux/OneList</span><br><span class=\"line\"><span class=\"comment\">#32位系统下载</span></span><br><span class=\"line\">wget https://raw.githubusercontent.com/MoeClub/OneList//master/Rewrite/i386/linux/OneList</span><br><span class=\"line\"><span class=\"comment\">#arm架构下载</span></span><br><span class=\"line\">wget https://raw.githubusercontent.com/MoeClub/OneList/master/Rewrite/arm/linux/OneList</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">#给予权限</span></span><br><span class=\"line\">chmod +x OneList</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"添加配置文件\">添加配置文件<a href=\"#添加配置文件\" title=\"添加配置文件\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 国际版</span></span><br><span class=\"line\">OneList -a <span class=\"string\">\"url\"</span> -s <span class=\"string\">\"/onedrive01\"</span></span><br><span class=\"line\"><span class=\"comment\"># 个人版(家庭版)</span></span><br><span class=\"line\">OneList -ms -a <span class=\"string\">\"url\"</span> -s <span class=\"string\">\"/onedrive02\"</span></span><br><span class=\"line\"><span class=\"comment\"># 中国版(世纪互联)</span></span><br><span class=\"line\">OneList -cn -a <span class=\"string\">\"url\"</span> -s <span class=\"string\">\"/onedrive03\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在浏览器地址栏中获取以 http://loaclhost 开头的整个url内容</span></span><br><span class=\"line\"><span class=\"comment\"># 将获取的完整url内容替换命令中的 url 三个字母</span></span><br><span class=\"line\"><span class=\"comment\"># 每次产生的 url 只能用一次, 重试请重新获取 url</span></span><br><span class=\"line\"><span class=\"comment\"># 可以一个盘内的多个文件夹分别映射到多个`SubPath`上</span></span><br><span class=\"line\"><span class=\"comment\"># 此操作将会自动添加的配置文件</span></span><br><span class=\"line\"><span class=\"comment\"># 提示 Success! Add config. '/path/to/config.json' 则成功</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"修改配置文件\">修改配置文件<a href=\"#修改配置文件\" title=\"修改配置文件\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 如果是家庭版或者个人免费版, 此项应为 true.</span></span><br><span class=\"line\">    <span class=\"attr\">\"MSAccount\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 如果是中国版(世纪互联), 此项应为 true.</span></span><br><span class=\"line\">    <span class=\"attr\">\"MainLand\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 授权令牌</span></span><br><span class=\"line\">    <span class=\"attr\">\"RefreshToken\"</span>: <span class=\"string\">\"1234564567890ABCDEF\"</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 单配置文件中,此项要唯一.将此OneDrive中设置为`RootPath`目录映射在`http://127.0.0.1:5288/onedrive` 下.</span></span><br><span class=\"line\">    <span class=\"comment\">// (只推荐一个盘位的时候使用根目录\"/\".)</span></span><br><span class=\"line\">    <span class=\"attr\">\"SubPath\"</span>: <span class=\"string\">\"/onedrive\"</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 读取OneDrive的某个目录作为根目录. (支持根目录\"/\")</span></span><br><span class=\"line\">    <span class=\"attr\">\"RootPath\"</span>: <span class=\"string\">\"/Test\"</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 隐藏OneDrive目录中的文件夹和文件, 条目间使用 \"|\" 分割. (跳过缓存设置的条目.)</span></span><br><span class=\"line\">    <span class=\"attr\">\"HidePath\"</span>: <span class=\"string\">\"/Test/Obj01|/Test/Obj02\"</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 使用用户名和密码加密OneDrive目录. 目录和用户名密码间使用 \"?\" 分割, 用户名密码使用 \":\" 分割, 条目间使用 \"|\" 分割. 无效条目将跳过. </span></span><br><span class=\"line\">    <span class=\"attr\">\"AuthPath\"</span>: <span class=\"string\">\"/Test/Auth01?user01:pwd01|/Test/Auth02?user02:pwd02\"</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 缓存刷新间隔.(所有项目中的刷新时间取最小值为有效刷新间隔)</span></span><br><span class=\"line\">    <span class=\"attr\">\"RefreshInterval\"</span>: <span class=\"number\">900</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用\">使用<a href=\"#使用\" title=\"使用\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Usage of OneList:</span><br><span class=\"line\">  -a string</span><br><span class=\"line\">        // 初始化配置文件,添加新配置</span><br><span class=\"line\">        Setup and Init auth.json.</span><br><span class=\"line\">  -<span class=\"built_in\">bind</span> string</span><br><span class=\"line\">        // 绑定IP地址(公网: 0.0.0.0)</span><br><span class=\"line\">        Bind Address (default <span class=\"string\">\"127.0.0.1\"</span>)</span><br><span class=\"line\">  -port string</span><br><span class=\"line\">        // 绑定端口(HTTP:80)</span><br><span class=\"line\">        Port (default <span class=\"string\">\"5288\"</span>)</span><br><span class=\"line\">  -s string</span><br><span class=\"line\">        // 设置 SubPath 项, 需要与 -a 一起使用.</span><br><span class=\"line\">        Set SubPath. [unique per account] (default <span class=\"string\">\"/\"</span>)</span><br><span class=\"line\">  -c string</span><br><span class=\"line\">        // 配置文件</span><br><span class=\"line\">        Config file. (default <span class=\"string\">\"config.json\"</span>)</span><br><span class=\"line\">  -t string</span><br><span class=\"line\">        // Index.html 目录样式文件</span><br><span class=\"line\">        Index file. (default <span class=\"string\">\"index.html\"</span>)</span><br><span class=\"line\">  -json</span><br><span class=\"line\">        // 开关</span><br><span class=\"line\">        // 数据以 json 形式输出当前目录数据</span><br><span class=\"line\">        Output json.</span><br><span class=\"line\">  -cn</span><br><span class=\"line\">        // 开关</span><br><span class=\"line\">        // 授权中国版(世纪互联), 需要此参数.</span><br><span class=\"line\">        OneDrive by 21Vianet.</span><br><span class=\"line\">  -ms</span><br><span class=\"line\">        // 开关</span><br><span class=\"line\">        // 授权个人版(家庭版), 需要此参数.</span><br><span class=\"line\">        OneDrive by Microsoft.</span><br><span class=\"line\">  -C string</span><br><span class=\"line\">        // 覆写所有预置的 Client ID. (不建议新手使用此参数)</span><br><span class=\"line\">        Set  Client ID. [Overwrite all clientId]</span><br><span class=\"line\">  -S string</span><br><span class=\"line\">        // 覆写所有预置的 Secret Key. (不建议新手使用此参数)</span><br><span class=\"line\">        Set Secret Key. [Overwrite all secretKey]</span><br><span class=\"line\">  -P string</span><br><span class=\"line\">        // 设置反代域名.此设置将全部流量定向到某个服务器或CDN,用于隐藏全局域名或者加速.</span><br><span class=\"line\">        // 每组以<span class=\"string\">\";\"</span>相间隔. 源域名与目标域名以<span class=\"string\">\"|\"</span>间隔. 可以设置多组.</span><br><span class=\"line\">        // 默认为空,使用时不要带中括号. (不建议新手使用此参数)</span><br><span class=\"line\">        Set Proxy Domain. [<span class=\"string\">\"x.sharepoint.com|domain.com;x.sharepoint.cn|domain.cn;...\"</span>]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"运行\">运行<a href=\"#运行\" title=\"运行\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 保证 config.json 和 index.html 同目录, 直接运行.</span><br><span class=\"line\">$ OneList</span><br><span class=\"line\"># 监听公网 80 端口</span><br><span class=\"line\">$ OneList -bind 0.0.0.0 -port 80</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"注意\">注意<a href=\"#注意\" title=\"注意\"></a></h2><ul><li>在初次缓存过程中或者打开空文件夹, 会提示 No Found.</li>\n<li>请使用 UTF-8 编码模式手动编辑 config.json 文件.</li>\n</ul><h2 id=\"nginx-反代配置\">Nginx 反代配置<a href=\"#nginx-反代配置\" title=\"Nginx 反代配置\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location ^~ &#x2F;onedrive&#x2F; &#123;</span><br><span class=\"line\">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">    proxy_pass http:&#x2F;&#x2F;127.0.0.1:5288;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"开机自启\">开机自启<a href=\"#开机自启\" title=\"开机自启\"></a></h2><p>这里新建一个简单的systemd配置文件，适用CentOS 7、Debian 8+、Ubuntu 16+。</p>\n<p>使用命令：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#设置你的运行监听端口，即你可以通过ip:端口访问程序，这里默认8000。</span></span><br><span class=\"line\">port=<span class=\"string\">\"8000\"</span></span><br><span class=\"line\"><span class=\"comment\">#将以下代码一起复制到SSH运行</span></span><br><span class=\"line\">cat &gt; /etc/systemd/system/onelist.service &lt;&lt;EOF</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=onelist</span><br><span class=\"line\">After=network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">ExecStart=/opt/OneList/OneList -<span class=\"built_in\">bind</span> 0.0.0.0 -port <span class=\"variable\">$&#123;port&#125;</span></span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"comment\">#启动并设置开机自启</span></span><br><span class=\"line\">systemctl start onelist</span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> onelist</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"卸载\">卸载<a href=\"#卸载\" title=\"卸载\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#未设置开机自启</span></span><br><span class=\"line\">rm -rf /opt/OneList</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#设置过开机自启</span></span><br><span class=\"line\">systemctl stop onelist</span><br><span class=\"line\">systemctl <span class=\"built_in\">disable</span> onelist</span><br><span class=\"line\">rm -rf /opt/OneList /etc/systemd/system/onelist.service</span><br></pre></td></tr></table></figure>","prev":{"title":"OneDrive 上传工具 OneDriveUploader","link":"2020/08/29/OneDriveUploader-use"},"next":{"title":"在Debian/Ubuntu上使用rclone挂载Google Drive网盘","link":"2020/07/24/mount-gd-for-rclone"},"plink":"https://gwliang.com/2020/08/25/onelist-use/","toc":[{"id":"onelist","title":"OneList","index":"1","children":[{"id":"授权","title":"授权","index":"1.1","children":[{"id":"通过下面url登录-右键新标签打开","title":"通过下面URL登录 (右键新标签打开)","index":"1.1.1"}]},{"id":"安装onelist","title":"安装OneList","index":"1.2"},{"id":"添加配置文件","title":"添加配置文件","index":"1.3"},{"id":"修改配置文件","title":"修改配置文件","index":"1.4"},{"id":"使用","title":"使用","index":"1.5"},{"id":"运行","title":"运行","index":"1.6"},{"id":"注意","title":"注意","index":"1.7"},{"id":"nginx-反代配置","title":"Nginx 反代配置","index":"1.8"},{"id":"开机自启","title":"开机自启","index":"1.9"},{"id":"卸载","title":"卸载","index":"1.10"}]}],"reward":true,"copyright":{"license":"自由转载-非商用-禁止演绎-保持署名(<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","author":"Gaowan Liang","link":"<a href=\"https://gwliang.com/2020/08/25/onelist-use/\" title=\"OneDrive目录列表OneList使用方法\">https://gwliang.com/2020/08/25/onelist-use/</a>"}}