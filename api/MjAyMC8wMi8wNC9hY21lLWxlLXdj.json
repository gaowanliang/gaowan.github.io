{"title":"使用 acme.sh 申请 Let's Encrypt 泛域名SSL证书详细教程","date":"2020-02-04T12:08:11.000Z","date_formatted":{"ll":"2020年2月4日","L":"2020/02/04","MM-DD":"02-04"},"link":"2020/02/04/acme-le-wc","comments":true,"tags":["SSL"],"categories":["教程"],"updated":"2020-02-04T12:22:29.541Z","content":"<h1 id=\"使用-acmesh-申请-let39s-encrypt-泛域名ssl证书详细教程\">使用 acme.sh 申请 Let&#39;s Encrypt 泛域名SSL证书详细教程<a href=\"#使用-acmesh-申请-let39s-encrypt-泛域名ssl证书详细教程\" title=\"使用 acme.sh 申请 Let&#39;s Encrypt 泛域名SSL证书详细教程\"></a></h1><h2 id=\"acmesh\">acme.sh<a href=\"#acmesh\" title=\"acme.sh\"></a></h2><p><code>acme.sh</code>是一个实现了 acme 协议的脚本，可以从 Let&#39;s Encrypt 生成免费的SSL证书</p>\n<p>本文只给出配合解析商 API 申请泛域名证书的过程教程，acme.sh还有很多很强大的功能例如配合 Nginx 或者 Apache 等自动申请证书，请自行查看 github 项目 wiki 发掘</p>\n<p><a href=\"https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E\" target=\"_blank\">https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E</a></p>\n<h2 id=\"部署-acmesh\">部署 acme.sh<a href=\"#部署-acmesh\" title=\"部署 acme.sh\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://get.acme.sh | sh</span><br><span class=\"line\"><span class=\"comment\"># 或者</span></span><br><span class=\"line\">wget -O- https://get.acme.sh | sh</span><br></pre></td></tr></table></figure>\n<h2 id=\"获取-cloudflare-的-api-信息\">获取 Cloudflare 的 API 信息<a href=\"#获取-cloudflare-的-api-信息\" title=\"获取 Cloudflare 的 API 信息\"></a></h2><p>acme.sh目前支持 cloudflare, dnspod, cloudxns, godaddy 以及 ovh 等数十种解析商的 API，可以自动添加 TXT 记录来验证，不需要人工操作，十分便捷</p>\n<p>详细可以看\n<a href=\"https://github.com/Neilpang/acme.sh/blob/master/dnsapi/README.md\" target=\"_blank\">https://github.com/Neilpang/acme.sh/blob/master/dnsapi/README.md</a></p>\n<p>这里以 Cloudflare 为例，CloudFlare Domain API提供了两种自动颁发证书的方法。</p>\n<h3 id=\"使用全局api密钥\">使用全局API密钥<a href=\"#使用全局api密钥\" title=\"使用全局API密钥\"></a></h3><p>首先，您需要登录到CloudFlare帐户以获取<a href=\"https://dash.cloudflare.com/profile\" target=\"_blank\">全局API密钥</a>。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/gaowanliang/p/img/20200204201527.png\" class=\"cy\"></p>\n<p>然后根据你的API密钥来填写下面的命令，并在服务器里执行</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export CF_Key&#x3D;&quot;sdfsdfsdfljlbjkljlkjsdfoiwje&quot;</span><br><span class=\"line\">export CF_Email&#x3D;&quot;xxxx@sss.com&quot;</span><br></pre></td></tr></table></figure>\n<p>其中<code>CF_Key</code>是你的Global API Key，<code>CF_Email</code>是你注册cloudflare的邮箱。</p>\n<h3 id=\"使用新的cloudflare-api令牌\">使用新的cloudflare API令牌<a href=\"#使用新的cloudflare-api令牌\" title=\"使用新的cloudflare API令牌\"></a></h3><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export CF_Token&#x3D;&quot;sdfsdfsdfljlbjkljlkjsdfoiwje&quot;</span><br><span class=\"line\">export CF_Account_ID&#x3D;&quot;xxxxxxxxxxxxx&quot;</span><br></pre></td></tr></table></figure>\n<p>没试过，只会第一种</p>\n<p>其他解析商的环境变量名是不一样的，详情去这里看\n<a href=\"https://github.com/Neilpang/acme.sh/blob/master/dnsapi/README.md\" target=\"_blank\">https://github.com/Neilpang/acme.sh/blob/master/dnsapi/README.md</a></p>\n<p>这个临时环境变量只需配置这一次，当成功申请证书后，API 信息会被自动保存在~/.acme.sh/account.conf，下次你使用acme.sh的时候会被自动使用</p>\n<h2 id=\"开始申请证书\">开始申请证书<a href=\"#开始申请证书\" title=\"开始申请证书\"></a></h2><p>接下来正式开始申请泛域名证书，将example.com换成你自己的域名</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~&#x2F;.acme.sh&#x2F;acme.sh --issue --dns dns_cf -d example.com -d &#39;*.example.com&#39;</span><br></pre></td></tr></table></figure>\n<p>--dns dns_cx参数表示使用 CloudXNS 的 API，如果是其他解析商，同样的，从上面那个链接可以看到对应参数</p>\n<p>然后静静等待即可</p>\n<h2 id=\"得到证书\">得到证书<a href=\"#得到证书\" title=\"得到证书\"></a></h2><p>申请完成后屏显会输出证书路径</p>\n<p>证书是<code>fullchain.cer</code>\n密匙是<code>example.com.key</code></p>\n<p>由于证书默认（在你没安装宝塔等同样调用 acme 签发证书的面板时）会在 acme 的内部目录<code>~/.acme.sh/</code>中生成，不建议直接使用该路径填写至 nginx 等配置中，而是使用<code>--installcert</code>命令，具体请参考↓</p>\n<p><a href=\"https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E#3-copy%E5%AE%89%E8%A3%85-%E8%AF%81%E4%B9%A6\" target=\"_blank\">https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E#3-copy%E5%AE%89%E8%A3%85-%E8%AF%81%E4%B9%A6</a></p>\n<h2 id=\"关于证书续期\">关于证书续期<a href=\"#关于证书续期\" title=\"关于证书续期\"></a></h2><p>Let&#39;s Encrypt 证书的有效期为三个月，<code>acme.sh</code>会每隔60天自动帮你续期，无需你进行任何干预</p>\n<p>如果你想强制续期或者取消自动续期可以看\n<a href=\"https://github.com/Neilpang/acme.sh#11-how-to-renew-the-certs\" target=\"_blank\">https://github.com/Neilpang/acme.sh#11-how-to-renew-the-certs</a></p>\n","next":{"title":"一个极简的HTTP Server： Caddy一键安装脚本，带网站配置教程","link":"2020/01/27/caddy-install"},"plink":"https://gwliang.com/2020/02/04/acme-le-wc/","toc":[{"id":"使用-acmesh-申请-let39s-encrypt-泛域名ssl证书详细教程","title":"使用 acme.sh 申请 Let&#39;s Encrypt 泛域名SSL证书详细教程","index":"1","children":[{"id":"acmesh","title":"acme.sh","index":"1.1"},{"id":"部署-acmesh","title":"部署 acme.sh","index":"1.2"},{"id":"获取-cloudflare-的-api-信息","title":"获取 Cloudflare 的 API 信息","index":"1.3","children":[{"id":"使用全局api密钥","title":"使用全局API密钥","index":"1.3.1"},{"id":"使用新的cloudflare-api令牌","title":"使用新的cloudflare API令牌","index":"1.3.2"}]},{"id":"开始申请证书","title":"开始申请证书","index":"1.4"},{"id":"得到证书","title":"得到证书","index":"1.5"},{"id":"关于证书续期","title":"关于证书续期","index":"1.6"}]}],"reward":true,"copyright":{"license":"自由转载-非商用-禁止演绎-保持署名(<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","author":"Gaowan Liang","link":"<a href=\"https://gwliang.com/2020/02/04/acme-le-wc/\" title=\"使用 acme.sh 申请 Let's Encrypt 泛域名SSL证书详细教程\">https://gwliang.com/2020/02/04/acme-le-wc/</a>"}}