{"title":"Debian系统安装Swap虚拟内存设置","date":"2020-05-16T12:31:37.000Z","date_formatted":{"ll":"2020年5月16日","L":"2020/05/16","MM-DD":"05-16"},"thumbnail":"https://cdn.jsdelivr.net/gh/gaowanliang/p/img/acv.jpg","link":"2020/05/16/set-swap","comments":true,"tags":["Linux"],"categories":["虚拟内存"],"updated":"2020-05-16T12:44:42.367Z","content":"<p>我玩的服务器大多数内存比较小，有的时候执行一些任务会搞得 out of memory ，这个时候就需要设置虚拟内存，最好的方法就是用萌鼠大佬的一键脚本。</p>\n<blockquote>\n<p>wget <a href=\"https://www.moerats.com/usr/shell/swap.sh\" target=\"_blank\">https://www.moerats.com/usr/shell/swap.sh</a> &amp;&amp; bash swap.sh</p>\n</blockquote>\n<p>但是有的时候执行完了会报错，这个时候就要麻烦一下，自己设置了</p>\n<h1 id=\"新增swap区\">新增swap区<a href=\"#新增swap区\" title=\"新增swap区\"></a></h1><ul><li>创建一个 文件作为swap区：<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dd <span class=\"keyword\">if</span>=/dev/zero of=/swapfile1 bs=1024 count=2000000</span><br></pre></td></tr></table></figure>\n名字为/swapfile1，大小为bs<em>count = 1024</em>2000000=2G，count代表的是大小，我这里是2G。</li>\n<li>将其转化为swap文件：<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkswap &#x2F;swapfile1</span><br></pre></td></tr></table></figure></li>\n<li>将其改为只有root权限才能修改（这个可以不弄）<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># chown root:root /swapfile1</span></span><br><span class=\"line\"><span class=\"comment\"># chmod 0600 /swapfile1</span></span><br></pre></td></tr></table></figure></li>\n<li>将其激活：<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">swapon /swapfile1</span><br></pre></td></tr></table></figure></li>\n<li>如果想要系统重启后生效，可以打开/etc/fstab在最后面加上一行：<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nano /etc/fstab</span><br><span class=\"line\"></span><br><span class=\"line\">/swapfile1 swap swap defaults 0 0</span><br></pre></td></tr></table></figure>\n<h1 id=\"更改swap区大小\">更改swap区大小<a href=\"#更改swap区大小\" title=\"更改swap区大小\"></a></h1></li>\n</ul><p>在网上没找到更多办法，有一个傻办法：</p>\n<p>1、通过上述的1～5步重建一个swap区，然后激活；</p>\n<p>2、先通过swapoff命令将之前的swap区失效，然后rm掉：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">swapoff /swapfile1</span><br></pre></td></tr></table></figure>","next":{"title":"免费开源的bitwarden_rs自建密码管理系统-安装,使用和备份教程","link":"2020/05/04/bitwarden-install"},"plink":"https://gwliang.com/2020/05/16/set-swap/","toc":[{"id":"新增swap区","title":"新增swap区","index":"1"},{"id":"更改swap区大小","title":"更改swap区大小","index":"2"}],"reward":true,"copyright":{"license":"自由转载-非商用-禁止演绎-保持署名(<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","author":"Gaowan Liang","link":"<a href=\"https://gwliang.com/2020/05/16/set-swap/\" title=\"Debian系统安装Swap虚拟内存设置\">https://gwliang.com/2020/05/16/set-swap/</a>"}}