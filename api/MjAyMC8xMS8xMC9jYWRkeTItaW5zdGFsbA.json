{"title":"Caddy 2 简明教程","date":"2020-11-10T09:53:10.000Z","date_formatted":{"ll":"2020年11月10日","L":"2020/11/10","MM-DD":"11-10"},"thumbnail":"https://cdn.jsdelivr.net/gh/gaowanliang/p/img/2020-11-11_214037.jpg","link":"2020/11/10/caddy2-install","comments":true,"tags":["教程"],"categories":["Caddy","建站"],"updated":"2020-11-11T13:41:49.011Z","content":"<h1 id=\"下载安装\">下载安装<a href=\"#下载安装\" title=\"下载安装\"></a></h1><p>目前有三种安装途径，分别为官网(下面)、Github、各系统包管理。</p>\n<p>官网的最方便，因为下载后直接就是二进制单文件，不需要多余的操作步骤（而且还能附加插件），而 Github 的是压缩包还需要解压、包管理则还需要修改包管理源。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建文件夹并进入（自己可以改）</span></span><br><span class=\"line\">mkdir /usr/<span class=\"built_in\">local</span>/caddy &amp;&amp; <span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/caddy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 下载 Caddy 文件，Caddy 2 不再支持 32 位系统了，如果要安装某些插件，还要进 https://caddyserver.com/download 去挑选一下</span></span><br><span class=\"line\">wget -N --no-check-certificate -O <span class=\"string\">\"caddy\"</span> <span class=\"string\">\"https://caddyserver.com/api/download?os=linux&amp;arch=amd64\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 赋予执行权限</span></span><br><span class=\"line\">chmod +x caddy</span><br></pre></td></tr></table></figure>\n<h1 id=\"配置示例\">配置示例<a href=\"#配置示例\" title=\"配置示例\"></a></h1><p>Caddy 2 可以用命令行启动 HTTP 服务，也可以用配置文件（默认：Caddyfile，当然新版也实现了用json这种方式控制，对于设计自动化和程序化的服务更简单了，但是用caddyfile习惯了，纯写还是caddyfile简单有效）。</p>\n<p>不过命令行方式启动只适合于临时使用，毕竟默认是前台运行，所以还是用配置文件吧。\n下列示例中，XXX.XX 为你的域名，如果要用 IP，请改成 :8080 ！</p>\n<h2 id=\"静态文件服务：\">静态文件服务：<a href=\"#静态文件服务：\" title=\"静态文件服务：\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 下面的几行命令是一个整体，请修改后一起复制粘贴去运行</span></span><br><span class=\"line\"><span class=\"comment\"># /usr/local/caddy/Caddyfile 为默认配置文件位置，可以改</span></span><br><span class=\"line\"><span class=\"comment\"># /home/xxx 为网站目录路径，如果省略则为 caddy 程序所在文件夹</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"XXX.XX &#123;</span></span><br><span class=\"line\"><span class=\"string\">    root * /home/xxx</span></span><br><span class=\"line\"><span class=\"string\">    file_server</span></span><br><span class=\"line\"><span class=\"string\">&#125;\"</span> &gt;&gt; /usr/<span class=\"built_in\">local</span>/caddy/Caddyfile</span><br></pre></td></tr></table></figure>\n<h2 id=\"目录列表服务：\">目录列表服务：<a href=\"#目录列表服务：\" title=\"目录列表服务：\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 下面的几行命令是一个整体，请修改后一起复制粘贴去运行</span></span><br><span class=\"line\"><span class=\"comment\"># /usr/local/caddy/Caddyfile 为默认配置文件位置，可以改</span></span><br><span class=\"line\"><span class=\"comment\"># /home/xxx 为网站目录路径，如果省略则为 caddy 程序所在文件夹</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"XXX.XX &#123;</span></span><br><span class=\"line\"><span class=\"string\">    root * /home/xxx</span></span><br><span class=\"line\"><span class=\"string\">    file_server browse</span></span><br><span class=\"line\"><span class=\"string\">&#125;\"</span> &gt;&gt; /usr/<span class=\"built_in\">local</span>/caddy/Caddyfile</span><br></pre></td></tr></table></figure>\n<h2 id=\"反向代理服务：\">反向代理服务：<a href=\"#反向代理服务：\" title=\"反向代理服务：\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 下面的几行命令是一个整体，请修改后一起复制粘贴去运行</span></span><br><span class=\"line\"><span class=\"comment\"># /usr/local/caddy/Caddyfile 为默认配置文件位置，可以改</span></span><br><span class=\"line\"><span class=\"comment\"># YYY.YY 是目标网站，https:// 和 :8080 省略后分别默认为 https 协议和 443 端口</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"XXX.XX &#123;</span></span><br><span class=\"line\"><span class=\"string\">    reverse_proxy https://YYY.YY:8080</span></span><br><span class=\"line\"><span class=\"string\">&#125;\"</span> &gt;&gt; /usr/<span class=\"built_in\">local</span>/caddy/Caddyfile</span><br></pre></td></tr></table></figure>\n\n<p>写好配置后，可以用这个命令检查下配置文件格式是否正确：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;caddy&#x2F;caddy validate</span><br></pre></td></tr></table></figure>\n<h1 id=\"启动停止\">启动停止<a href=\"#启动停止\" title=\"启动停止\"></a></h1><p>Caddy 2 直接集成启动/停止等命令了，连系统服务脚本都不需要了！</p>\n<p>当然如果你想要守护进程，那么你还需要根据官网教程配置 systemd 系统服务。</p>\n<h2 id=\"启动\">启动<a href=\"#启动\" title=\"启动\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># start 命令是后台运行（可以关闭 SSH 终端），而 run 命令是前台运行。</span></span><br><span class=\"line\"><span class=\"comment\"># 启动成功会提示：Successfully started Caddy (pid=XXXX) - Caddy is running in the background</span></span><br><span class=\"line\"></span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/caddy/caddy start</span><br></pre></td></tr></table></figure>\n<h2 id=\"停止\">停止<a href=\"#停止\" title=\"停止\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 停止成功会提示：stopping now, bye!!  </span></span><br><span class=\"line\"></span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/caddy/caddy stop</span><br></pre></td></tr></table></figure>\n<h2 id=\"重载配置\">重载配置<a href=\"#重载配置\" title=\"重载配置\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 修改配置文件后不需要重启 Caddy ，重载一下就行了！</span></span><br><span class=\"line\"></span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/caddy/caddy reload</span><br></pre></td></tr></table></figure>\n<h2 id=\"其他说明\">其他说明<a href=\"#其他说明\" title=\"其他说明\"></a></h2><p>如果嫌弃每次都要用 <code>/usr/local/caddy/caddy</code>执行命令，那可以做个软链接：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 软链接类似于 Windows 的快捷方式</span></span><br><span class=\"line\">ln -s /usr/<span class=\"built_in\">local</span>/caddy/caddy /usr/bin/caddy</span><br></pre></td></tr></table></figure>\n<p>这样你就可以把 <code>/usr/local/caddy/caddy start</code> 等命令简化为 <code>caddy start</code> 了！</p>\n","prev":{"title":"优雅的批量重命名文件","link":"2020/11/22/batch-rename-file"},"next":{"title":"OneDrive 上传工具 OneDriveUploader","link":"2020/08/29/OneDriveUploader-use"},"plink":"https://gwliang.com/2020/11/10/caddy2-install/","toc":[{"id":"下载安装","title":"下载安装","index":"1"},{"id":"配置示例","title":"配置示例","index":"2","children":[{"id":"静态文件服务：","title":"静态文件服务：","index":"2.1"},{"id":"目录列表服务：","title":"目录列表服务：","index":"2.2"},{"id":"反向代理服务：","title":"反向代理服务：","index":"2.3"}]},{"id":"启动停止","title":"启动停止","index":"3","children":[{"id":"启动","title":"启动","index":"3.1"},{"id":"停止","title":"停止","index":"3.2"},{"id":"重载配置","title":"重载配置","index":"3.3"},{"id":"其他说明","title":"其他说明","index":"3.4"}]}],"reward":true,"copyright":{"license":"自由转载-非商用-禁止演绎-保持署名(<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","author":"Gaowan Liang","link":"<a href=\"https://gwliang.com/2020/11/10/caddy2-install/\" title=\"Caddy 2 简明教程\">https://gwliang.com/2020/11/10/caddy2-install/</a>"}}