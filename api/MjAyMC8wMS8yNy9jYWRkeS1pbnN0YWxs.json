{"title":"一个极简的HTTP Server： Caddy一键安装脚本，带网站配置教程","date":"2020-01-27T06:05:27.000Z","date_formatted":{"ll":"2020年1月27日","L":"2020/01/27","MM-DD":"01-27"},"thumbnail":"https://cdn.jsdelivr.net/gh/gaowanliang/p/img/74664457_p0.jpg","link":"2020/01/27/caddy-install","comments":true,"tags":["建站"],"categories":["Caddy","建站","转载"],"updated":"2020-01-27T06:38:39.669Z","content":"<h1 id=\"一个极简的http-server：-caddy一键安装脚本，带网站配置教程\">一个极简的HTTP Server： Caddy一键安装脚本，带网站配置教程<a href=\"#一个极简的http-server：-caddy一键安装脚本，带网站配置教程\" title=\"一个极简的HTTP Server： Caddy一键安装脚本，带网站配置教程\"></a></h1><p><strong>说明：</strong>这几天一直在看逗比根据地，发现<code>Caddy</code>很是强大，是一个极简的<code>HTTP</code>服务器，支持<code>HTTP/2</code>静态网页服务器，安装也很快，在很多方面都可以不用安装时间很长的<code>lnmp</code>，<code>lamp</code>环境了，配置文件也很简单，同时还有一些有趣的扩展，可以非常方便的搭建一个<code>HTTP</code>服务器。</p>\n<h2 id=\"安装\">安装<a href=\"#安装\" title=\"安装\"></a></h2><p><strong>系统要求：</strong><code>CentOS 6+</code>/<code>Debian 6+</code>/<code>Ubuntu 14.04 +</code>。推荐<code>Debian 7 x64</code>。</p>\n<p>本脚本只是一个一键安装+运行控制的脚本，没有其他管理虚拟主机等功能。</p>\n<p>执行下面的代码安装<code>Caddy</code>，如果想要安装其他扩展可以把名字加到命令后面（<code>bash caddy_install.sh install xxx,xxx,xxx，</code>扩展列表<a href=\"https://caddyserver.com/download\" target=\"_blank\">点击查看</a>）。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -N --no-check-certificate https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;ToyoDAdoubiBackup&#x2F;doubi&#x2F;master&#x2F;caddy_install.sh &amp;&amp; chmod +x caddy_install.sh &amp;&amp; bash caddy_install.sh</span><br><span class=\"line\">#备用地址</span><br><span class=\"line\">wget -N --no-check-certificate https:&#x2F;&#x2F;gwliang.com&#x2F;caddy_install.sh &amp;&amp; chmod +x caddy_install.sh &amp;&amp; bash caddy_install.sh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用说明\">使用说明<a href=\"#使用说明\" title=\"使用说明\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">启动：&#x2F;etc&#x2F;init.d&#x2F;caddy start</span><br><span class=\"line\">停止：&#x2F;etc&#x2F;init.d&#x2F;caddy stop</span><br><span class=\"line\">重启：&#x2F;etc&#x2F;init.d&#x2F;caddy restart</span><br><span class=\"line\">查看状态：&#x2F;etc&#x2F;init.d&#x2F;caddy status</span><br><span class=\"line\">查看Caddy启动日志：tail -f &#x2F;tmp&#x2F;caddy.log</span><br><span class=\"line\">安装目录：&#x2F;usr&#x2F;local&#x2F;caddy</span><br><span class=\"line\">Caddy配置文件位置：&#x2F;usr&#x2F;local&#x2F;caddy&#x2F;Caddyfile</span><br><span class=\"line\">Caddy自动申请SSL证书位置：&#x2F;.caddy&#x2F;acme&#x2F;acme-v01.api.letsencrypt.org&#x2F;sites&#x2F;xxx.xxx(域名)&#x2F;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"升级caddy或者更新扩展\">升级Caddy或者更新扩展<a href=\"#升级caddy或者更新扩展\" title=\"升级Caddy或者更新扩展\"></a></h2><p>只需要重新执行你当初安装时候用的命令即可，会覆盖安装最新的<code>Caddy+</code>扩展。</p>\n<h2 id=\"卸载caddy\">卸载Caddy<a href=\"#卸载caddy\" title=\"卸载Caddy\"></a></h2><p>卸载不会删除虚拟主机的内容，只会删除<code>Caddy</code>自身和配置文件。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubiBackup/doubi/master/caddy_install.sh &amp;&amp; bash caddy_install.sh uninstall</span><br><span class=\"line\"><span class=\"comment\">#备用地址</span></span><br><span class=\"line\">wget -N --no-check-certificate https://gwliang.com/caddy_install.sh &amp;&amp; bash caddy_install.sh uninstall</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"网站配置文件\">网站配置文件<a href=\"#网站配置文件\" title=\"网站配置文件\"></a></h2><p>配置文件为<code>Caddyfile</code>，列举几种<code>caddy</code>的<code>conf</code>的写法</p>\n<p><strong>1、本地访问80</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:80</span><br></pre></td></tr></table></figure>\n<p><strong>2、单网站访问</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">example.com</span><br><span class=\"line\">root &#x2F;usr&#x2F;local&#x2F;caddy&#x2F;www</span><br><span class=\"line\">&#x2F;&#x2F;更多模块</span><br></pre></td></tr></table></figure>\n<p><strong>2、多网站</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">example.com &#123;</span><br><span class=\"line\">  gzip</span><br><span class=\"line\">  root &#x2F;usr&#x2F;local&#x2F;caddy&#x2F;www</span><br><span class=\"line\">  &#x2F;&#x2F;更多模块</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>常用基本组成模块，均写入到<code>conf</code>站点配置中。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#log日志</span><br><span class=\"line\">log &#x2F;usr&#x2F;local&#x2F;caddy&#x2F;www&#x2F;example.log</span><br><span class=\"line\"></span><br><span class=\"line\">#目录访问</span><br><span class=\"line\">browse</span><br><span class=\"line\"></span><br><span class=\"line\">#gzip压缩</span><br><span class=\"line\">gzip</span><br><span class=\"line\"></span><br><span class=\"line\">#自主ssl证书</span><br><span class=\"line\">tls &#x2F;path&#x2F;ssl&#x2F;example.com.crt &#x2F;path&#x2F;ssl&#x2F;example.com.key</span><br><span class=\"line\"></span><br><span class=\"line\">#访问口令认证（用户emiria，密码abc123）</span><br><span class=\"line\">basicauth &#x2F; emiria abc123</span><br><span class=\"line\"></span><br><span class=\"line\">#跳转功能</span><br><span class=\"line\">redir http:&#x2F;&#x2F;example.com&#123;url&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">#自定义错误页面</span><br><span class=\"line\">errors &#123;</span><br><span class=\"line\">  404 404.html</span><br><span class=\"line\">  500 &#x2F;usr&#x2F;local&#x2F;caddy&#x2F;www&#x2F;500.html</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>例如，通过<code>IP</code>即<code>80</code>端口访问目录：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:80 &#123;</span><br><span class=\"line\">  root &#x2F;usr&#x2F;local&#x2F;caddy&#x2F;www</span><br><span class=\"line\">  gzip</span><br><span class=\"line\">  browse</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>也可以直接执行命令写入，以下是一个命令，直接复制粘贴即可。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;:80 &#123;</span><br><span class=\"line\">  root &#x2F;usr&#x2F;local&#x2F;caddy&#x2F;www</span><br><span class=\"line\">  gzip</span><br><span class=\"line\">  browse</span><br><span class=\"line\">&#125;&quot; &gt; &#x2F;usr&#x2F;local&#x2F;caddy&#x2F;Caddyfile</span><br></pre></td></tr></table></figure>\n<p>更多配置参考：<a href=\"https://caddyserver.com/tutorial/caddyfile\" target=\"_blank\">https://caddyserver.com/tutorial/caddyfile</a>\n设置文档参考：<a href=\"https://caddyserver.com/docs\" target=\"_blank\">https://caddyserver.com/docs</a></p>\n<h2 id=\"常见问题\">常见问题<a href=\"#常见问题\" title=\"常见问题\"></a></h2><p><strong>1、Caddy启动失败，打开ip访问地址显示的是 It works !</strong>\n一些系统会自带<code>apache2</code>，而<code>apache2</code>会占用<code>80</code>端口，导致<code>Caddy</code>无法绑定端口，所以只要关掉就好了。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat -lntp</span><br><span class=\"line\"># 我们可以通过这个命令查看是不是被其他软件占用了80端口。</span><br></pre></td></tr></table></figure>\n<p>不过<code>apache2</code>会默认开机自启动，如果不需要可以关闭自启动或者卸载<code>apache2</code>。</p>\n<p>停止<code>Apache2</code></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># CentOS系统</span><br><span class=\"line\">&#x2F;etc&#x2F;init.d&#x2F;httpd stop</span><br><span class=\"line\"># Debian&#x2F;Ubuntu系统</span><br><span class=\"line\">&#x2F;etc&#x2F;init.d&#x2F;apache2 stop</span><br><span class=\"line\"> </span><br><span class=\"line\"># 尝试使用上面代码关闭，如果没效果或者提示什么错误无法关闭，那就用下面这个强行关闭进程。</span><br><span class=\"line\">kill -9 $(ps -ef|grep &quot;apache2&quot;|grep -v &quot;grep&quot;|awk &#39;&#123;print $2&#125;&#39;)</span><br></pre></td></tr></table></figure>\n<p>取消开机自启动</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># CentOS 系统</span><br><span class=\"line\">chkconfig --del httpd</span><br><span class=\"line\"># Debian&#x2F;Ubuntu 系统</span><br><span class=\"line\">update-rc.d -f apache2 remove</span><br></pre></td></tr></table></figure>\n<p>卸载<code>Apache2</code></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># CentOS 系统</span><br><span class=\"line\">yum remove httpd</span><br><span class=\"line\"># Debian&#x2F;Ubuntu 系统</span><br><span class=\"line\">apt-get remove --purge apache2</span><br></pre></td></tr></table></figure>\n<p>关闭<code>Apache2</code>后，就可以尝试启动<code>Caddy</code>，并试试能不能打开网页。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;etc&#x2F;init.d&#x2F;caddy start</span><br></pre></td></tr></table></figure>\n<p><strong>2、启动Caddy后，无法访问</strong>\n这个可能是防火墙的问题，开放防火墙端口即可。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -I INPUT -m state --state NEW -m tcp -p tcp --dport 端口 -j ACCEPT</span><br><span class=\"line\">iptables -I INPUT -m state --state NEW -m udp -p udp --dport 端口 -j ACCEPT</span><br><span class=\"line\"> </span><br><span class=\"line\"># 删除防火墙规则，内容一样把 -I 换成 -D 就行了：</span><br><span class=\"line\">iptables -D INPUT -m state --state NEW -m tcp -p tcp --dport 端口 -j ACCEPT</span><br><span class=\"line\">iptables -D INPUT -m state --state NEW -m udp -p udp --dport 端口 -j ACCEPT</span><br></pre></td></tr></table></figure>\n\n<p><strong>3、SSL证书签发失败</strong>\n比如报错<code>acme: error: 400 :: urn:ietf:params:acme:error:connection :: Error getting validation data, url:</code>，检查下防火墙端口，需要开启<code>80</code>和<code>443</code>端口，然后重启即可。</p>\n<h2 id=\"转载声明\">转载声明<a href=\"#转载声明\" title=\"转载声明\"></a></h2><p>原文链接：<a href=\"https://www.moerats.com/archives/404/\" target=\"_blank\">https://www.moerats.com/archives/404/</a></p>\n","prev":{"title":"使用 acme.sh 申请 Let's Encrypt 泛域名SSL证书详细教程","link":"2020/02/04/acme-le-wc"},"next":{"title":"Wi-Fi 等无线网络安全审计方法","link":"2020/01/24/wifi-cracking"},"plink":"https://gwliang.com/2020/01/27/caddy-install/","toc":[{"id":"一个极简的http-server：-caddy一键安装脚本，带网站配置教程","title":"一个极简的HTTP Server： Caddy一键安装脚本，带网站配置教程","index":"1","children":[{"id":"安装","title":"安装","index":"1.1"},{"id":"使用说明","title":"使用说明","index":"1.2"},{"id":"升级caddy或者更新扩展","title":"升级Caddy或者更新扩展","index":"1.3"},{"id":"卸载caddy","title":"卸载Caddy","index":"1.4"},{"id":"网站配置文件","title":"网站配置文件","index":"1.5"},{"id":"常见问题","title":"常见问题","index":"1.6"},{"id":"转载声明","title":"转载声明","index":"1.7"}]}],"reward":true}